<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代理編輯</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="p-4">
        <!-- 標題和返回按鈕 -->
        <div class="flex items-center mb-6">
            <button id="back-btn" class="mr-4 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>
                返回
            </button>
            <h1 class="text-xl font-semibold text-gray-800">代理編輯</h1>
        </div>

        <!-- 編輯表單 -->
        <div class="bg-white shadow-sm rounded-lg p-6">
            <form id="agent-edit-form">
                <input type="hidden" id="edit-agent-id" name="agent_id" value="">
                
                <!-- 區塊二：基本資料 -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">基本資料</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6">
                        <!-- 上層代理帳號 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">上層代理帳號</label>
                            <div id="parent-agent-account" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md shadow-sm text-sm"></div>
                        </div>
                        
                        <!-- 代理帳號 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">代理帳號</label>
                            <div id="agent-account" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md shadow-sm text-sm"></div>
                        </div>

                        <!-- 帳號啟用狀態 -->
                        <div>
                            <label for="agent-status" class="block text-sm font-medium text-gray-700">帳號啟用狀態</label>
                            <select id="agent-status" name="agent-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                <option value="active">啟用</option>
                                <option value="inactive">停用</option>
                            </select>
                        </div>

                        <!-- 帳戶餘額 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">帳戶餘額</label>
                            <div id="agent-balance" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md shadow-sm text-sm font-medium text-green-600"></div>
                        </div>
                        
                        <!-- 代理姓名 -->
                        <div>
                            <label for="agent-name" class="block text-sm font-medium text-gray-700">代理姓名</label>
                            <input type="text" name="agent-name" id="agent-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        
                        <!-- 電子郵件 -->
                        <div>
                            <label for="agent-email" class="block text-sm font-medium text-gray-700">電子郵件</label>
                            <input type="email" name="agent-email" id="agent-email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        
                        <!-- 手機號碼 -->
                        <div>
                            <label for="agent-phone" class="block text-sm font-medium text-gray-700">手機號碼</label>
                            <input type="tel" name="agent-phone" id="agent-phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                    </div>
                </div>
                
                <!-- 佔成比例設定 -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">佔成比例設定</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6">
                        <!-- 上層佔成比例 -->
                        <div>
                            <label for="agent-upper-profit-rate" class="block text-sm font-medium text-gray-700">當前佔成比例</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <input type="number" name="agent-upper-profit-rate" id="agent-upper-profit-rate" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md bg-gray-100" placeholder="50" value="50" min="0" max="100" step="0.1" readonly>
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">%</span>
                                </div>
                            </div>
                        </div>
                        
                                            <!-- 佔成比例 -->
                    <div>
                        <label for="agent-profit-rate" class="block text-sm font-medium text-gray-700">下層佔成比例</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <input type="number" name="agent-profit-rate" id="agent-profit-rate" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md bg-gray-100" placeholder="30" min="0" max="100" step="0.1" readonly>
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 sm:text-sm">%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 區塊一：返佣比例設定 -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-4">返佣比例設定</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6">
                        <!-- 左側欄位 -->
                        <div class="space-y-4">
                            <!-- 賽前上層返佣比例 (左上) -->
                            <div>
                                <label for="agent-upper-commission" class="block text-sm font-medium text-gray-700">賽前上層返佣比例</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <input type="number" name="agent-upper-commission" id="agent-upper-commission" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md bg-gray-100" placeholder="0" min="0" max="2" step="0.05" readonly>
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500 sm:text-sm">%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 走地上層返佣比例 (左下) -->
                            <div>
                                <label for="agent-upper-live-commission" class="block text-sm font-medium text-gray-700">走地上層返佣比例</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <input type="number" name="agent-upper-live-commission" id="agent-upper-live-commission" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md bg-gray-100" placeholder="0" min="0" max="2" step="0.05" readonly>
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500 sm:text-sm">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右側欄位 -->
                        <div class="space-y-4">
                                                    <!-- 賽前返佣比例 (右上) -->
                        <div>
                            <label for="agent-commission" class="block text-sm font-medium text-gray-700">賽前返佣比例</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <input type="number" name="agent-commission" id="agent-commission" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="3" min="0" max="2" step="0.05">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500 sm:text-sm">%</span>
                                    </div>
                                </div>
                            </div>
                            
                                                    <!-- 走地返佣比例 (右下) -->
                        <div>
                            <label for="agent-live-commission" class="block text-sm font-medium text-gray-700">走地返佣比例</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <input type="number" name="agent-live-commission" id="agent-live-commission" class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="2" min="0" max="2" step="0.05">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500 sm:text-sm">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 底部按鈕 -->
                <div class="mt-6 flex justify-between space-x-3">
                    <!-- 重置密碼按鈕（最左側） -->
                    <div>
                        <button type="button" id="reset-agent-password-btn" class="inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-yellow-600 text-base font-medium text-white hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 sm:text-sm">
                            重置代理密碼
                        </button>
                        <p class="mt-1 text-xs text-gray-500">點擊後代理密碼會變為預設密碼（0000）</p>
                    </div>
                    
                    <!-- 右側按鈕 -->
                    <div class="flex space-x-3">
                        <button type="button" id="reset-form-btn" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none">
                            重置
                        </button>
                        <button type="submit" id="save-agent-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                            儲存變更
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 提示模態窗口 -->
    <div id="confirm-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <!-- 模態視窗內容 -->
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                確認離開
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">
                                    您已經修改了資料但尚未儲存，確定要離開此頁面嗎？
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirm-leave-btn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                        確認離開
                    </button>
                    <button type="button" id="cancel-leave-btn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 獲取URL參數
            const urlParams = new URLSearchParams(window.location.search);
            const agentId = urlParams.get('id');
            
            // 設置表單初始值（實際應用中應該從API獲取）
            document.getElementById('edit-agent-id').value = agentId;
            document.getElementById('parent-agent-account').textContent = 'admin';
            document.getElementById('agent-account').textContent = 'agent' + agentId;
            document.getElementById('agent-balance').textContent = '150,000';
            document.getElementById('agent-name').value = '代理' + agentId;
            document.getElementById('agent-email').value = 'agent' + agentId + '@example.com';
            document.getElementById('agent-phone').value = '1330000' + agentId.padStart(4, '0');
            
            // 佔成比例相關設定
            const initialUpperProfitRate = 50; // 上層佔成比例初始值
            const initialAgentProfitRate = 35; // 佔成比例初始值
            
            document.getElementById('agent-upper-profit-rate').value = (initialUpperProfitRate - initialAgentProfitRate);
            document.getElementById('agent-profit-rate').value = initialAgentProfitRate;
            
            // 保持佔成比例輸入欄位為唯讀狀態
            const profitRateInput = document.getElementById('agent-profit-rate');
            const upperProfitRateInput = document.getElementById('agent-upper-profit-rate');
            
            // 移除原本讓下層佔成比例可編輯的代碼，保持唯讀狀態
            
            // 由於下層佔成比例為唯讀狀態，移除輸入變化監聽器
            
            document.getElementById('agent-commission').value = '1.5';
            document.getElementById('agent-live-commission').value = '1';
            document.getElementById('agent-upper-commission').value = '0.5';
            document.getElementById('agent-upper-live-commission').value = '0.3';
            document.getElementById('agent-status').value = 'active'; // 設定預設為啟用狀態
            
            // 初始化表單原始值，用於檢測變更
            const initialFormValues = getFormValues();
            
            // 返回按鈕點擊事件
            document.getElementById('back-btn').addEventListener('click', (e) => {
                if (formHasChanged(initialFormValues)) {
                    // 顯示確認對話框
                    e.preventDefault();
                    document.getElementById('confirm-modal').classList.remove('hidden');
                } else {
                    // 直接返回列表頁
                    history.back();
                }
            });
            
            // 重置表單按鈕
            document.getElementById('reset-form-btn').addEventListener('click', () => {
                // 重置為初始值
                document.getElementById('agent-name').value = initialFormValues['agent-name'];
                document.getElementById('agent-email').value = initialFormValues['agent-email'];
                document.getElementById('agent-phone').value = initialFormValues['agent-phone'];
                
                // 重置佔成比例到初始值
                document.getElementById('agent-profit-rate').value = initialAgentProfitRate;
                document.getElementById('agent-upper-profit-rate').value = initialUpperProfitRate - initialAgentProfitRate;
                
                document.getElementById('agent-commission').value = initialFormValues['agent-commission'];
                document.getElementById('agent-live-commission').value = initialFormValues['agent-live-commission'];
                document.getElementById('agent-upper-commission').value = initialFormValues['agent-upper-commission'];
                document.getElementById('agent-upper-live-commission').value = initialFormValues['agent-upper-live-commission'];
                document.getElementById('agent-status').value = initialFormValues['agent-status'];
            });
            
            // 儲存變更按鈕
            document.getElementById('agent-edit-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                // 下層佔成比例為唯讀狀態，無需驗證
                
                // 驗證賽前返佣比例
                const commission = document.getElementById('agent-commission').value;
                if (commission === '' || isNaN(parseFloat(commission)) || parseFloat(commission) < 0 || parseFloat(commission) > 2) {
                    alert('請輸入有效的賽前返佣比例（0-2之間的數字）');
                    return;
                }
                
                // 驗證走地返佣比例
                const liveCommission = document.getElementById('agent-live-commission').value;
                if (liveCommission === '' || isNaN(parseFloat(liveCommission)) || parseFloat(liveCommission) < 0 || parseFloat(liveCommission) > 2) {
                    alert('請輸入有效的走地返佣比例（0-2之間的數字）');
                    return;
                }
                
                // 驗證賽前上層返佣比例
                const upperCommission = document.getElementById('agent-upper-commission').value;
                if (upperCommission === '' || isNaN(parseFloat(upperCommission)) || parseFloat(upperCommission) < 0 || parseFloat(upperCommission) > 2) {
                    alert('請輸入有效的賽前上層返佣比例（0-2之間的數字）');
                    return;
                }
                
                // 驗證走地上層返佣比例
                const upperLiveCommission = document.getElementById('agent-upper-live-commission').value;
                if (upperLiveCommission === '' || isNaN(parseFloat(upperLiveCommission)) || parseFloat(upperLiveCommission) < 0 || parseFloat(upperLiveCommission) > 2) {
                    alert('請輸入有效的走地上層返佣比例（0-2之間的數字）');
                    return;
                }
                
                // 模擬保存操作
                alert('代理資料已更新');
                
                // 更新初始值
                const updatedFormValues = getFormValues();
                Object.keys(initialFormValues).forEach(key => {
                    initialFormValues[key] = updatedFormValues[key];
                });
            });
            
            // 重置密碼按鈕
            document.getElementById('reset-agent-password-btn').addEventListener('click', () => {
                if (confirm('確定要重置代理密碼嗎？')) {
                    // 模擬密碼重置操作
                    alert('代理密碼已重置為預設密碼(0000)');
                }
            });
            
            // 確認離開按鈕
            document.getElementById('confirm-leave-btn').addEventListener('click', () => {
                history.back();
            });
            
            // 取消離開按鈕
            document.getElementById('cancel-leave-btn').addEventListener('click', () => {
                document.getElementById('confirm-modal').classList.add('hidden');
            });
            
            // 獲取表單值
            function getFormValues() {
                return {
                    'agent-name': document.getElementById('agent-name').value,
                    'agent-email': document.getElementById('agent-email').value,
                    'agent-phone': document.getElementById('agent-phone').value,
                    'agent-profit-rate': document.getElementById('agent-profit-rate').value,
                    'agent-upper-profit-rate': document.getElementById('agent-upper-profit-rate').value,
                    'agent-commission': document.getElementById('agent-commission').value,
                    'agent-live-commission': document.getElementById('agent-live-commission').value,
                    'agent-upper-commission': document.getElementById('agent-upper-commission').value,
                    'agent-upper-live-commission': document.getElementById('agent-upper-live-commission').value,
                    'agent-status': document.getElementById('agent-status').value
                };
            }
            
            // 判斷表單是否已變更
            function formHasChanged(initialValues) {
                const currentValues = getFormValues();
                return Object.keys(initialValues).some(key => {
                    return initialValues[key] !== currentValues[key];
                });
            }
        });
    </script>
</body>
</html> 