<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新增賽事</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 添加日期選擇器樣式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body class="bg-gray-50">
    <div class="p-4">
        <!-- 標題和返回按鈕 -->
        <div class="flex items-center mb-6">
            <button id="back-btn" class="mr-4 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>
                返回
            </button>
            <h1 class="text-xl font-semibold text-gray-800">新增賽事</h1>
        </div>

        <!-- 賽事資料新增表單 -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="p-6">
                <form id="add-match-form">
                    <!-- 基本賽事資料 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">基本賽事資料</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6">
                            <!-- 賽事編號 -->
                            <div>
                                <label for="match-id" class="block text-sm font-medium text-gray-700">賽事編號</label>
                                <input type="text" name="match-id" id="match-id" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100" placeholder="系統自動生成" readonly>
                                <p class="mt-1 text-xs text-gray-500">系統自動填入，格式為 [聯賽代碼]-[YYYYMMDD]-[流水號]</p>
                            </div>
                            
                            <!-- 所屬聯賽 -->
                            <div>
                                <label for="league" class="block text-sm font-medium text-gray-700">所屬聯賽 <span class="text-red-500">*</span></label>
                                <select name="league" id="league" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
                                    <option value="">請選擇聯賽</option>
                                    <option value="EPL">英超聯賽</option>
                                    <option value="LAL">西甲聯賽</option>
                                    <option value="BUN">德甲聯賽</option>
                                    <option value="SEA">義甲聯賽</option>
                                    <option value="FRA">法甲聯賽</option>
                                </select>
                            </div>
                            
                            <!-- 主隊名稱 -->
                            <div>
                                <label for="home-team" class="block text-sm font-medium text-gray-700">主隊名稱 <span class="text-red-500">*</span></label>
                                <input type="text" name="home-team" id="home-team" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                            
                            <!-- 客隊名稱 -->
                            <div>
                                <label for="away-team" class="block text-sm font-medium text-gray-700">客隊名稱 <span class="text-red-500">*</span></label>
                                <input type="text" name="away-team" id="away-team" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                            
                            <!-- 賽事開始時間 -->
                            <div>
                                <label for="match-time" class="block text-sm font-medium text-gray-700">賽事開始時間 <span class="text-red-500">*</span></label>
                                <input type="text" name="match-time" id="match-time" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="YYYY-MM-DD HH:MM" required>
                            </div>
                            
                            <!-- 賽事狀態 -->
                            <div>
                                <label for="match-status" class="block text-sm font-medium text-gray-700">賽事狀態</label>
                                <input type="text" name="match-status" id="match-status" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-100" value="開放投注" readonly>
                                <input type="hidden" name="match-status-value" id="match-status-value" value="開放投注">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 讓球設定 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">讓球設定</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6">
                            <!-- 讓球隊伍 -->
                            <div>
                                <label for="handicap-team" class="block text-sm font-medium text-gray-700">讓球隊伍 <span class="text-red-500">*</span></label>
                                <select name="handicap-team" id="handicap-team" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
                                    <option value="">請選擇讓球隊伍</option>
                                </select>
                            </div>
                            
                            <!-- 讓球數 -->
                            <div>
                                <label for="handicap-value" class="block text-sm font-medium text-gray-700">讓球數 <span class="text-red-500">*</span></label>
                                <input type="number" name="handicap-value" id="handicap-value" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0" value="0" required>
                            </div>
                            
                            <!-- 盤口讓球賠率 -->
                            <div>
                                <label for="handicap-draw-odds" class="block text-sm font-medium text-gray-700">盤口讓球賠率 <span class="text-red-500">*</span></label>
                                <input type="number" name="handicap-draw-odds" id="handicap-draw-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0" value="0" required>
                                <p class="mt-1 text-xs text-gray-500">當比分等於讓球數時使用此賠率，有效值範圍不超過±100</p>
                            </div>
                            
                            <!-- 賽事前主隊賠率 -->
                            <div>
                                <label for="pre-home-odds" class="block text-sm font-medium text-gray-700">賽事前主隊賠率</label>
                                <input type="number" name="pre-home-odds" id="pre-home-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.85" value="0.85" min="0" max="2" step="0.01" required>
                            </div>
                            
                            <!-- 賽事前客隊賠率 -->
                            <div>
                                <label for="pre-away-odds" class="block text-sm font-medium text-gray-700">賽事前客隊賠率</label>
                                <input type="number" name="pre-away-odds" id="pre-away-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.85" value="0.85" min="0" max="2" step="0.01" required>
                            </div>
                            
                            <!-- 賽事中主隊賠率 -->
                            <div>
                                <label for="live-home-odds" class="block text-sm font-medium text-gray-700">賽事中主隊賠率</label>
                                <input type="number" name="live-home-odds" id="live-home-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.80" value="0.80" min="0" max="2" step="0.01" required>
                            </div>
                            
                            <!-- 賽事中客隊賠率 -->
                            <div>
                                <label for="live-away-odds" class="block text-sm font-medium text-gray-700">賽事中客隊賠率</label>
                                <input type="number" name="live-away-odds" id="live-away-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.80" value="0.80" min="0" max="2" step="0.01" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 大小球設定 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">大小球設定</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6">
                            <!-- 大小球球數 -->
                            <div>
                                <label for="total-goals" class="block text-sm font-medium text-gray-700">大小球球數 <span class="text-red-500">*</span></label>
                                <input type="number" name="total-goals" id="total-goals" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0" value="0" required>
                            </div>
                            
                            <!-- 盤口大小球賠率 -->
                            <div>
                                <label for="total-draw-odds" class="block text-sm font-medium text-gray-700">盤口大小球賠率 <span class="text-red-500">*</span></label>
                                <input type="number" name="total-draw-odds" id="total-draw-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0" value="0" required>
                                <p class="mt-1 text-xs text-gray-500">當總進球數等於大小球球數時使用此賠率，有效值範圍不超過±100</p>
                            </div>
                            
                            <!-- 賽事前大球賠率 -->
                            <div>
                                <label for="pre-over-odds" class="block text-sm font-medium text-gray-700">賽事前大球賠率</label>
                                <input type="number" name="pre-over-odds" id="pre-over-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.85" value="0.85" min="0" max="2" step="0.01" required>
                            </div>
                            
                            <!-- 賽事前小球賠率 -->
                            <div>
                                <label for="pre-under-odds" class="block text-sm font-medium text-gray-700">賽事前小球賠率</label>
                                <input type="number" name="pre-under-odds" id="pre-under-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.85" value="0.85" min="0" max="2" step="0.01" required>
                            </div>
                            
                            <!-- 賽事中大球賠率 -->
                            <div>
                                <label for="live-over-odds" class="block text-sm font-medium text-gray-700">賽事中大球賠率</label>
                                <input type="number" name="live-over-odds" id="live-over-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.80" value="0.80" min="0" max="2" step="0.01" required>
                            </div>
                            
                            <!-- 賽事中小球賠率 -->
                            <div>
                                <label for="live-under-odds" class="block text-sm font-medium text-gray-700">賽事中小球賠率</label>
                                <input type="number" name="live-under-odds" id="live-under-odds" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="0.80" value="0.80" min="0" max="2" step="0.01" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 按鈕區 -->
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" id="reset-btn" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none">
                            重置
                        </button>
                        <button type="submit" id="submit-match" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                            新增賽事
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 引入 Flatpickr 日期選擇器 -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化日期時間選擇器
            flatpickr("#match-time", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                locale: "zh-tw",
                minDate: "today",
                defaultHour: new Date().getHours() + 1
            });
            
            // 獲取主隊和客隊輸入框以及讓球隊伍下拉選單
            const homeTeamInput = document.getElementById('home-team');
            const awayTeamInput = document.getElementById('away-team');
            const handicapTeamSelect = document.getElementById('handicap-team');
            
            // 監聽主隊和客隊輸入變化以更新讓球隊伍選項
            function updateHandicapTeamOptions() {
                const homeTeam = homeTeamInput.value.trim();
                const awayTeam = awayTeamInput.value.trim();
                
                // 清空現有選項
                handicapTeamSelect.innerHTML = '<option value="">請選擇讓球隊伍</option>';
                
                // 如果主隊名稱不為空，則添加為選項
                if (homeTeam) {
                    const homeOption = document.createElement('option');
                    homeOption.value = homeTeam;
                    homeOption.textContent = homeTeam;
                    handicapTeamSelect.appendChild(homeOption);
                }
                
                // 如果客隊名稱不為空，則添加為選項
                if (awayTeam) {
                    const awayOption = document.createElement('option');
                    awayOption.value = awayTeam;
                    awayOption.textContent = awayTeam;
                    handicapTeamSelect.appendChild(awayOption);
                }
            }
            
            // 監聽輸入變化
            homeTeamInput.addEventListener('input', updateHandicapTeamOptions);
            awayTeamInput.addEventListener('input', updateHandicapTeamOptions);
            
            // 表單元素
            const addMatchForm = document.getElementById('add-match-form');
            const resetBtn = document.getElementById('reset-btn');
            const backBtn = document.getElementById('back-btn');
            
            // 返回按鈕點擊事件
            backBtn.addEventListener('click', function() {
                window.location.href = 'list.html';
            });
            
            // 重置按鈕點擊事件
            resetBtn.addEventListener('click', function() {
                addMatchForm.reset();
                updateHandicapTeamOptions();
            });
            
            // 表單提交事件
            addMatchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 獲取表單數據
                const league = document.getElementById('league').value;
                const homeTeam = document.getElementById('home-team').value;
                const awayTeam = document.getElementById('away-team').value;
                const matchTime = document.getElementById('match-time').value;
                const matchStatus = document.getElementById('match-status').value; // 獲取唯讀狀態值
                const handicapTeam = document.getElementById('handicap-team').value;
                const handicapValue = document.getElementById('handicap-value').value;
                const handicapDrawOdds = document.getElementById('handicap-draw-odds').value;
                const totalGoals = document.getElementById('total-goals').value;
                const totalDrawOdds = document.getElementById('total-draw-odds').value;
                
                // 基本表單驗證
                if (!league || !homeTeam || !awayTeam || !matchTime || !handicapTeam) {
                    alert('請填寫所有必填欄位');
                    return;
                }
                
                // 賽事狀態固定為「開放投注」，無需額外驗證
                
                // 驗證盤口讓球賠率
                if (handicapDrawOdds === '' || isNaN(parseInt(handicapDrawOdds)) || Math.abs(parseInt(handicapDrawOdds)) > 100) {
                    alert('請輸入有效的盤口讓球賠率（不超過±100）');
                    return;
                }
                
                // 驗證盤口大小球賠率
                if (totalDrawOdds === '' || isNaN(parseInt(totalDrawOdds)) || Math.abs(parseInt(totalDrawOdds)) > 100) {
                    alert('請輸入有效的盤口大小球賠率（不超過±100）');
                    return;
                }
                
                // 驗證比賽時間是否是未來時間
                const selectedDate = new Date(matchTime);
                const now = new Date();
                if (selectedDate <= now) {
                    alert('賽事開始時間不能設置為過去時間');
                    return;
                }
                
                // 準備提交的數據
                const formData = {
                    league: league,
                    homeTeam: homeTeam,
                    awayTeam: awayTeam,
                    matchTime: matchTime,
                    matchStatus: matchStatus, // 固定為「開放投注」
                    handicapTeam: handicapTeam,
                    handicapValue: parseFloat(handicapValue),
                    handicapDrawOdds: parseInt(handicapDrawOdds),
                    totalGoals: parseFloat(totalGoals),
                    totalDrawOdds: parseInt(totalDrawOdds),
                    preHomeOdds: parseFloat(document.getElementById('pre-home-odds').value),
                    preAwayOdds: parseFloat(document.getElementById('pre-away-odds').value),
                    liveHomeOdds: parseFloat(document.getElementById('live-home-odds').value),
                    liveAwayOdds: parseFloat(document.getElementById('live-away-odds').value),
                    preOverOdds: parseFloat(document.getElementById('pre-over-odds').value),
                    preUnderOdds: parseFloat(document.getElementById('pre-under-odds').value),
                    liveOverOdds: parseFloat(document.getElementById('live-over-odds').value),
                    liveUnderOdds: parseFloat(document.getElementById('live-under-odds').value)
                };
                
                console.log('要提交的數據:', formData);
                
                // 模擬表單提交成功
                alert('賽事新增成功');
                
                // 在實際系統中，這裡會發送API請求來新增賽事
                
                // 新增成功後返回列表頁
                window.location.href = 'list.html';
            });
            
            // 自動生成賽事編號範例（僅用於演示）
            function generateMatchId() {
                const league = document.getElementById('league').value || 'XXX';
                const date = new Date();
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const randomNum = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
                
                return `${league}-${year}${month}${day}-${randomNum}`;
            }
            
            // 更新自動賽事編號，當聯賽選擇變更時
            document.getElementById('league').addEventListener('change', function() {
                if (this.value) {
                    document.getElementById('match-id').value = generateMatchId();
                } else {
                    document.getElementById('match-id').value = '';
                }
            });
            
            // 模擬系統自動填入的賠率資料
            function initializeOddsData() {
                // 設置預設的系統賠率數據（示範用）
                // 這裡不再需要設置初始值，因為已經在 HTML 中設置了預設值
            }
            
            // 初始化頁面
            initializeOddsData();
        });
    </script>
</body>
</html> 