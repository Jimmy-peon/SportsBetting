<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金流紀錄</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 添加日期選擇器樣式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body class="bg-gray-50">
    <div class="p-4">
        <!-- 過濾與搜尋 -->
        <div class="bg-white rounded-lg shadow-sm mb-6 p-4">
            <div class="flex flex-col justify-between items-start gap-4">
                <div class="w-full">
                    <!-- 層級和交易類型選單 -->
                    <div class="flex flex-col sm:flex-row mb-3 items-start sm:items-center gap-3">
                        <!-- 層級選單 -->
                        <div class="flex items-center">
                            <span class="mr-2 text-sm font-medium text-gray-700">層級</span>
                            <select id="level-type" class="mr-4 w-32 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 py-2 px-3 text-sm">
                                <option value="">全部</option>
                                <option value="SH">SH</option>
                                <option value="SSMA">SSMA</option>
                                <option value="SMA">SMA</option>
                                <option value="MA">MA</option>
                                <option value="Agent">Agent</option>
                                <option value="Member">Member</option>
                            </select>
                        </div>
                        
                        <!-- 交易類型選單 -->
                        <div class="flex items-center">
                            <span class="mr-2 text-sm font-medium text-gray-700">交易類型</span>
                            <select id="transaction-type" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-32">
                                <option value="">全部</option>
                                <option value="deposit">儲值</option>
                                <option value="withdraw">提款</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 搜尋條件和時間篩選 -->
                    <div class="flex flex-col sm:flex-row mb-3 items-start sm:items-center gap-3">
                        <!-- 搜尋條件 -->
                        <div class="flex items-center flex-wrap sm:flex-nowrap">
                            <span class="mr-2 text-sm font-medium text-gray-700">條件</span>
                            <select id="search-type" class="mr-2 w-32 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 py-2 px-3 text-sm">
                                <option value="username" selected>帳號</option>
                                <option value="name">姓名</option>
                            </select>
                            <input id="search-keyword" type="text" placeholder="請輸入關鍵字..." class="w-full sm:w-64 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 py-2 px-3 text-sm">
                        </div>
                        
                        <!-- 時間篩選 - 改為支援時分選擇 -->
                        <div class="flex items-center flex-grow">
                            <span class="mr-2 text-sm font-medium text-gray-700">創建時間</span>
                            <div class="flex flex-grow gap-1">
                                <input type="text" id="start-date" placeholder="起始日期時間" class="datetimepicker border border-gray-300 rounded-md px-3 py-2 text-sm flex-grow" readonly>
                                <span class="self-center">-</span>
                                <input type="text" id="end-date" placeholder="結束日期時間" class="datetimepicker border border-gray-300 rounded-md px-3 py-2 text-sm flex-grow" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 查詢與重置按鈕 -->
                    <div class="flex gap-2 mb-3">
                        <button id="search-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none flex items-center">
                            <i class="fas fa-search mr-2"></i>
                            查詢
                        </button>
                        <button id="reset-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none flex items-center">
                            <i class="fas fa-redo-alt mr-2"></i>
                            重置
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 充值記錄表格 -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                交易帳號
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                帳號姓名
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                交易金額
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                交易類型
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                交易後餘額
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                備註
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                創建時間
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- 待處理儲值 -->
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">agent888</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">張代理</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">50,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    儲值
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 font-medium">330,000 → 380,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">首次加值</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">2023-06-15 09:12:45</div>
                            </td>
                        </tr>
                        
                        <!-- 已審核提款 -->
                        <tr class="hover:bg-gray-50" data-status="approved">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">super123</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">王總監</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">200,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    提款
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 font-medium">500,000 → 300,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">資金調整</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">2023-06-15 08:45:12</div>
                            </td>
                        </tr>

                        <!-- 待處理儲值 -->
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">agent456</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">林代理</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">30,800</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    儲值
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 font-medium">119,200 → 150,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">定期加值</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">2023-06-15 09:05:30</div>
                            </td>
                        </tr>

                        <!-- 已拒絕儲值 -->
                        <tr class="hover:bg-gray-50" data-status="rejected">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">super456</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">李總監</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">15,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    儲值
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 font-medium">0 → 0</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">額度不足</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">2023-06-15 08:15:50</div>
                            </td>
                        </tr>

                        <!-- 待處理提款 -->
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">topsh001</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">高主管</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">80,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    提款
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 font-medium">280,000 → 200,000</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">週結回收</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">2023-06-15 08:05:22</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 分頁控制 與原始檔相同 -->
            <div class="bg-white px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                <div class="flex-1 flex justify-between sm:hidden">
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        上一頁
                    </a>
                    <a href="#" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        下一頁
                    </a>
                </div>
                <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                    <div>
                        <p class="text-sm text-gray-700">
                            顯示第 <span class="font-medium">1</span> 到 <span class="font-medium">5</span> 筆，共 <span class="font-medium">124</span> 筆結果
                        </p>
                    </div>
                    <div>
                        <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                            <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">上一頁</span>
                                <i class="fas fa-chevron-left text-xs"></i>
                            </a>
                            <a href="#" aria-current="page" class="z-10 bg-indigo-50 border-indigo-500 text-indigo-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                                1
                            </a>
                            <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                                2
                            </a>
                            <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                                3
                            </a>
                            <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                                ...
                            </span>
                            <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                                25
                            </a>
                            <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">下一頁</span>
                                <i class="fas fa-chevron-right text-xs"></i>
                            </a>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- 充值詳情彈窗 (隱藏) -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 hidden" id="transfer-detail-modal">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-lg mx-auto p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">金流交易詳情</h3>
                    <button type="button" id="close-detail-modal" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <!-- 代理信息 -->
                    <div class="bg-gray-50 p-3 rounded">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">交易資訊</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div>
                                <span class="text-gray-500">交易帳號：</span>
                                <span class="text-gray-900" id="detail-username">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">帳號姓名：</span>
                                <span class="text-gray-900" id="detail-name">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">目前餘額：</span>
                                <span class="text-gray-900" id="detail-balance">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 交易信息 -->
                    <div>
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700">交易類型</label>
                            <div class="mt-1 p-2 bg-gray-50 border border-gray-200 rounded-md text-sm" id="detail-transaction-type">-</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700">交易金額</label>
                            <div class="mt-1 p-2 bg-gray-50 border border-gray-200 rounded-md text-sm" id="detail-amount">-</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700">創建時間</label>
                            <div class="mt-1 p-2 bg-gray-50 border border-gray-200 rounded-md text-sm" id="detail-created-time">-</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700">備註</label>
                            <div class="mt-1 p-2 bg-gray-50 border border-gray-200 rounded-md h-20 overflow-y-auto text-sm" id="detail-note">-</div>
                        </div>
                    </div>
                    
                    <div class="text-right">
                        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md" id="close-detail-btn">
                            關閉
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加日期選擇器 -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 配置起始日期時間選擇器 - 支援年月日時分
            const startDatePicker = flatpickr("#start-date", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                locale: "zh-tw",
                onChange: function(selectedDates, dateStr) {
                    // 當選擇起始日期後，自動聚焦到結束日期
                    if (selectedDates.length > 0) {
                        setTimeout(() => {
                            document.getElementById('end-date').focus();
                        }, 100);
                    }
                }
            });
            
            // 配置結束日期時間選擇器 - 支援年月日時分
            const endDatePicker = flatpickr("#end-date", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                locale: "zh-tw"
            });

            // 搜尋按鈕事件
            document.getElementById('search-btn').addEventListener('click', function() {
                const searchType = document.getElementById('search-type').value;
                const keyword = document.getElementById('search-keyword').value.trim();
                
                if (!keyword) {
                    alert('請輸入搜尋關鍵字');
                    return;
                }
                
                // 實際應用中會發送請求到後端API
                console.log('搜尋類型:', searchType, '關鍵字:', keyword);
                
                // 篩選表格
                filterTableRows();
            });
            
            // 重置按鈕事件
            document.getElementById('reset-btn').addEventListener('click', function() {
                document.getElementById('search-type').value = 'username';
                document.getElementById('search-keyword').value = '';
                document.getElementById('transaction-type').value = '';
                document.getElementById('level-type').value = '';
                startDatePicker.clear();
                endDatePicker.clear();
                
                // 重置篩選結果
                document.querySelectorAll('tbody tr').forEach(row => {
                    row.style.display = '';
                });
            });
            
            // 簡單的表格篩選功能
            function filterTableRows() {
                const searchType = document.getElementById('search-type').value;
                const keyword = document.getElementById('search-keyword').value.trim().toLowerCase();
                
                document.querySelectorAll('tbody tr').forEach(row => {
                    let cellValue = '';
                    let columnIndex = 0;
                    
                    // 根據搜尋類型確定查詢的列
                    switch(searchType) {
                        case 'username':
                            columnIndex = 0; // 交易帳號
                            break;
                        case 'name':
                            columnIndex = 1; // 帳號姓名
                            break;
                    }
                    
                    cellValue = row.querySelectorAll('td')[columnIndex].innerText.toLowerCase();
                    
                    if (cellValue.includes(keyword)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
            
            // 支持Enter鍵搜尋
            document.getElementById('search-keyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('search-btn').click();
                }
            });
            
            // 為金流狀態為「已審核」或「拒絕」的記錄添加可點擊查看詳情功能
            document.querySelectorAll('tr[data-status="approved"], tr[data-status="rejected"]').forEach(row => {
                row.style.cursor = 'pointer';
                row.addEventListener('dblclick', function() {
                    showTransferDetail(this);
                });
            });
            
            // 顯示充提詳情
            function showTransferDetail(row) {
                // 提取數據
                const username = row.querySelector('td:nth-child(1) .text-sm').textContent.trim();
                const name = row.querySelector('td:nth-child(2) .text-sm').textContent.trim();
                const amount = row.querySelector('td:nth-child(3) .text-sm').textContent.trim();
                const transactionType = row.querySelector('td:nth-child(4) span').textContent.trim();
                const balanceInfo = row.querySelector('td:nth-child(5) .text-sm').textContent.trim();
                const note = row.querySelector('td:nth-child(6) .text-sm').textContent.trim();
                const createdTime = row.querySelector('td:nth-child(7) .text-sm').textContent.trim();
                
                // 模擬獲取帳戶餘額 (實際情況應該從API獲取)
                let balance = '';
                if (username === 'agent888') {
                    balance = '380,000';
                } else if (username === 'agent456') {
                    balance = '150,000';
                } else {
                    balance = '0';
                }
                
                // 填充數據到詳情視窗
                document.getElementById('detail-username').textContent = username;
                document.getElementById('detail-name').textContent = name;
                document.getElementById('detail-balance').textContent = balance;
                document.getElementById('detail-transaction-type').textContent = transactionType;
                document.getElementById('detail-amount').textContent = amount;
                document.getElementById('detail-created-time').textContent = createdTime;
                document.getElementById('detail-note').textContent = note;
                
                // 顯示詳情視窗
                document.getElementById('transfer-detail-modal').classList.remove('hidden');
            }
            
            // 關閉彈窗事件
            document.getElementById('close-detail-modal').addEventListener('click', function() {
                document.getElementById('transfer-detail-modal').classList.add('hidden');
            });
            
            document.getElementById('close-detail-btn').addEventListener('click', function() {
                document.getElementById('transfer-detail-modal').classList.add('hidden');
            });
        });
    </script>
</body>
</html>
 