<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注單詳情</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="p-4">
        <!-- 返回按鈕 -->
        <div class="mb-4">
            <a href="order.html" class="inline-flex items-center px-3 py-1.5 text-sm border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                <i class="fas fa-arrow-left mr-1.5 text-xs"></i>
                返回
            </a>
        </div>
        
        <!-- 注單基本資訊區 -->
        <div class="bg-white rounded-lg shadow-sm mb-6 p-4">
            <h2 class="text-lg font-medium text-gray-800 mb-4">基本資訊</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- 注單單號 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">注單單號</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="order-id"></div>
                </div>
                
                <!-- 注單狀態 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">注單狀態</label>
                    <div class="inline-block px-2 py-1 rounded-full text-xs font-semibold" id="order-status"></div>
                </div>
                
                <!-- 會員帳號 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">會員帳號</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="member-account"></div>
                </div>
                
                <!-- 會員姓名 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">會員姓名</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="member-name"></div>
                </div>
                
                <!-- 投注時間 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">投注時間</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="bet-time"></div>
                </div>
                
                <!-- 派彩時間 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">派彩時間</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="payout-time"></div>
                </div>
            </div>
        </div>
        
        <!-- 賽事資訊區 -->
        <div class="bg-white rounded-lg shadow-sm mb-6 p-4">
            <h2 class="text-lg font-medium text-gray-800 mb-4">賽事資訊</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- 賽事編號 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">賽事編號</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="match-id"></div>
                </div>
                
                <!-- 賽事開始時間 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">賽事開始時間</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="match-time"></div>
                </div>
                
                <!-- 賠率 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">賠率</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="odds">
                        <!-- 將由JS填充，包含賠率信息和標籤 -->
                    </div>
                </div>
                
                <!-- 讓球隊伍 (只在投注類型為讓球時顯示) -->
                <div id="handicap-team-container" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">讓球隊伍</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="handicap-team"></div>
                </div>
                
                <!-- 投注類型 (原賽事類型) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">投注類型</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="match-type"></div>
                </div>
                
                <!-- 投注對象 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">投注對象</label>
                    <div class="bg-gray-100 rounded-md px-3 py-2 text-sm text-gray-800" id="bet-target"></div>
                </div>
                

            </div>
        </div>
        
        <!-- 投注結果區 (原投注資訊) -->
        <div class="bg-white rounded-lg shadow-sm mb-6 p-4">
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-sm font-medium text-gray-700">投注結果</span>
                    <span class="text-sm font-medium text-gray-900" id="match-result"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm font-medium text-gray-700">投注金額</span>
                    <span class="text-sm font-medium text-gray-900" id="bet-amount"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm font-medium text-gray-700">有效投注金額</span>
                    <span class="text-sm font-medium text-gray-900" id="effective-bet-amount"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm font-medium text-gray-700">派彩金額</span>
                    <span class="text-sm font-medium text-gray-900" id="payout-amount"></span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm font-medium text-gray-700">輸贏</span>
                    <span class="text-sm font-medium" id="win-loss"></span>
                </div>

            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 從 URL 獲取注單 ID
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('id');
            
            // 添加調試輸出
            console.log('獲取到的注單ID:', orderId);
            console.log('注單ID類型:', typeof orderId);
            
            // 模擬根據注單 ID 獲取詳細數據的過程
            // 在實際應用中，這裡會發送 API 請求獲取詳細數據
            const orderDetail = getOrderDetailById(orderId);
            
            // 添加調試輸出
            console.log('返回的注單狀態:', orderDetail.status);
            
            // 渲染基本信息
            renderBasicInfo(orderDetail);
            
            // 渲染賽事信息
            renderMatchInfo(orderDetail.betInfo[0]);
            
            // 渲染投注信息
            renderBetInfo(orderDetail);
        });
        
        // 模擬獲取訂單詳情的函數
        function getOrderDetailById(orderId) {
            // 調試輸出
            console.log('進入getOrderDetailById函數，參數:', orderId);
            
            // 特殊處理截圖中的注單
            if (orderId === 'BET20240513002') {
                console.log('匹配到特定注單ID: BET20240513002');
                return {
                    id: 'BET20240513002',
                    status: '取消',
                    memberAccount: 'user456',
                    memberName: '李四',
                    betTime: '2024-05-13 11:30:15',
                    payoutTime: '',
                    betAmount: 800,
                    effectiveBetAmount: 0,
                    winLoss: 0,
                    payoutAmount: 0,
                    betInfo: [
                        {
                            matchId: 'MATCH20240513002',
                            matchType: '讓球',
                            betTarget: '主隊',
                            handicapTeam: '主隊',
                            matchTime: '20240513 15:00',
                            matchTag: '賽前',
                            odds: '3(-10)0.95',
                            betAmount: 800,
                            matchResult: '-',
                            winLoss: 0,
                            payoutAmount: 0,
                            status: '取消',
                            cancelReason: '玩家取消'
                        }
                    ]
                };
            } 
            // 檢查是否有參數包含BET20240513002，但由於某些原因未精確匹配
            else if (orderId && orderId.includes('BET20240513002')) {
                console.log('包含但未精確匹配 BET20240513002，實際值:', orderId);
                return {
                    id: 'BET20240513002',
                    status: '取消',
                    memberAccount: 'user456',
                    memberName: '李四',
                    betTime: '2024-05-13 11:30:15',
                    payoutTime: '',
                    betAmount: 800,
                    effectiveBetAmount: 0,
                    winLoss: 0,
                    payoutAmount: 0,
                    betInfo: [
                        {
                            matchId: 'MATCH20240513002',
                            matchType: '讓球',
                            betTarget: '主隊',
                            handicapTeam: '主隊',
                            matchTime: '20240513 15:00',
                            matchTag: '賽前',
                            odds: '3(-10)0.95',
                            betAmount: 800,
                            matchResult: '-',
                            winLoss: 0,
                            payoutAmount: 0,
                            status: '取消',
                            cancelReason: '玩家取消'
                        }
                    ]
                };
            }
            else if (orderId && orderId.includes('CANCEL')) {
                console.log('匹配到包含CANCEL的注單ID');
                // 其他取消注單
                return {
                    id: orderId,
                    status: '取消',
                    memberAccount: 'user456',
                    memberName: '李四',
                    betTime: '2024-05-13 11:30:15',
                    payoutTime: '',
                    betAmount: 800,
                    effectiveBetAmount: 0,
                    winLoss: 0,
                    payoutAmount: 0,
                    betInfo: [
                        {
                            matchId: 'MATCH20240513002',
                            matchType: '讓球',
                            betTarget: '主隊',
                            handicapTeam: '主隊',
                            matchTime: '20240513 15:00',
                            matchTag: '賽前',
                            odds: '3(-10)0.95',
                            betAmount: 800,
                            matchResult: '-',
                            winLoss: 0,
                            payoutAmount: 0,
                            status: '取消',
                            cancelReason: '玩家取消'
                        }
                    ]
                };
            }
            
            console.log('未匹配到特殊條件，返回默認注單');
            // 默認返回正常注單
            return {
                id: orderId || 'BET20240512001',
                status: '已結算',
                memberAccount: 'user123',
                memberName: '張三',
                betTime: '2024-05-12 14:30:22',
                payoutTime: '2024-05-12 16:45:18',
                betAmount: 1000,
                effectiveBetAmount: 1000,
                winLoss: 850,
                payoutAmount: 1850,
                betInfo: [
                    {
                        matchId: 'MATCH20240512001',
                        matchType: '讓球',
                        betTarget: '主隊',
                        handicapTeam: '主隊',
                        matchTime: '20240512 15:00',
                        matchTag: '賽前',
                        odds: '3(-10)0.95',
                        betAmount: 1000,
                        matchResult: 'HW',
                        winLoss: 850,
                        payoutAmount: 1850,
                        status: '已結算',
                        cancelReason: ''
                    }
                ]
            };
        }
        
        // 渲染基本信息
        function renderBasicInfo(data) {
            document.getElementById('order-id').textContent = data.id;
            
            const statusEl = document.getElementById('order-status');
            statusEl.textContent = data.status;
            
            // 設置狀態的顏色
            if (data.status === '已結算') {
                statusEl.classList.add('bg-green-100', 'text-green-800');
            } else if (data.status === '待結算') {
                statusEl.classList.add('bg-yellow-100', 'text-yellow-800');
            } else if (data.status === '取消') {
                statusEl.classList.add('bg-gray-100', 'text-gray-800');
            } else if (data.status === '結算中') {
                statusEl.classList.add('bg-blue-100', 'text-blue-800');
            }
            
            document.getElementById('member-account').textContent = data.memberAccount;
            document.getElementById('member-name').textContent = data.memberName;
            document.getElementById('bet-time').textContent = data.betTime;
            document.getElementById('payout-time').textContent = data.payoutTime || '-';
        }
        
        // 渲染賽事信息
        function renderMatchInfo(matchData) {
            document.getElementById('match-id').textContent = matchData.matchId;
            document.getElementById('match-type').textContent = matchData.matchType;
            document.getElementById('bet-target').textContent = matchData.betTarget;
            document.getElementById('match-time').textContent = matchData.matchTime;
            
            // 處理讓球隊伍顯示
            if (matchData.matchType === '讓球') {
                document.getElementById('handicap-team-container').classList.remove('hidden');
                document.getElementById('handicap-team').textContent = matchData.handicapTeam || '主隊';
            } else {
                document.getElementById('handicap-team-container').classList.add('hidden');
            }
            
            // 處理賠率顯示
            const oddsText = matchData.odds;
            const oddsEl = document.getElementById('odds');
            
            // 解析賠率格式：進球數(盤口賠率)賽事返獎率
            const oddsRegex = /(\d+\.?\d*)\(([-+]\d+)\)(0\.\d+)/;
            const oddsMatch = oddsText.match(oddsRegex);
            
            if (oddsMatch) {
                const goalNumber = oddsMatch[1];
                const handicap = oddsMatch[2];
                const paybackRate = oddsMatch[3];
                
                const handicapColor = handicap.startsWith('+') ? 'text-green-600' : 'text-red-600';
                
                oddsEl.innerHTML = `
                    ${goalNumber}(<span class="${handicapColor}">${handicap}</span>)${paybackRate}
                    <span class="ml-1 px-1.5 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800">
                        ${matchData.matchTag}
                    </span>
                `;
            } else {
                oddsEl.textContent = oddsText;
            }
            

        }
        
        // 渲染投注信息
        function renderBetInfo(data) {
            document.getElementById('bet-amount').textContent = data.betAmount.toLocaleString();
            document.getElementById('effective-bet-amount').textContent = data.effectiveBetAmount.toLocaleString();
            document.getElementById('payout-amount').textContent = data.payoutAmount.toLocaleString();
            document.getElementById('match-result').textContent = data.betInfo[0].matchResult;
            
            const winLossEl = document.getElementById('win-loss');
            winLossEl.textContent = (data.winLoss > 0 ? '+' : '') + data.winLoss.toLocaleString();
            
            // 設置輸贏顏色
            if (data.winLoss > 0) {
                winLossEl.classList.add('text-green-600');
            } else if (data.winLoss < 0) {
                winLossEl.classList.add('text-red-600');
            } else {
                winLossEl.classList.add('text-gray-600');
            }
        }
    </script>
</body>
</html> 